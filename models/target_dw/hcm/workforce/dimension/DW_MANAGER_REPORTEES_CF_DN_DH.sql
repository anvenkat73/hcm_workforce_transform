 SELECT  SPAN.ASSIGNMENT_ID AS MANAGER_ASSIGNMENT_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL20_REPORTEE_ASSIGNMENT_ID , 
  SPAN.EFFECTIVE_START_DATE AS EFFECTIVE_START_DATE , 
  SPAN.EFFECTIVE_END_DATE AS EFFECTIVE_END_DATE , 
  'LINE_MANAGER' AS MANAGER_TYPE , 
 SPAN.ASSIGNMENT_ID||'~'||SPAN.ASSIGNMENT_ID||'~'||TO_CHAR(SPAN.EFFECTIVE_START_DATE,'YYYYMMDD')||'~'|| TO_CHAR(SPAN.EFFECTIVE_END_DATE,'YYYYMMDD')||'~'||'LINE_MANAGER' AS SOURCE_RECORD_ID, 
  SPAN.PERSON_ID AS MANAGER_ID , 
  SPAN.PERSON_ID AS LEVEL20_REPORTEE_PERSON_ID , 
  0 AS MANAGER_DISTANCE , 
  SPAN.PERSON_ID AS LEVEL1_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL1_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL2_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL2_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL3_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL3_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL4_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL4_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL5_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL5_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL6_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL6_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL7_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL7_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL8_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL8_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL9_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL9_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL10_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL10_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL11_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL11_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL12_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL12_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL13_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL13_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL14_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL14_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL15_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL15_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL16_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL16_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL17_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL17_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL18_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL18_REPORTEE_ASSIGNMENT_ID , 
  SPAN.PERSON_ID AS LEVEL19_REPORTEE_PERSON_ID , 
  SPAN.ASSIGNMENT_ID AS LEVEL19_REPORTEE_ASSIGNMENT_ID , 
 GREATEST(TO_DATE(SUBSTR('$VAR_PARAM_GLOBAL_INITIAL_EXTRACT_DATE$',1,19),'YYYY-MM-DD HH24:MI:SS'),SPAN.EFFECTIVE_START_DATE) AS DW_DATE_FROM, 
 SPAN.EFFECTIVE_END_DATE AS DW_DATE_TO, 
  CASE WHEN TO_DATE(SUBSTR('$VAR_PARAM_GLOBAL_INITIAL_EXTRACT_DATE$',1,19),'YYYY-MM-DD HH24:MI:SS') > SPAN.EFFECTIVE_START_DATE  THEN 1 ELSE 0 END AS DW_INITIAL_RECORD_IND
 FROM {{ ref('DW_WRKFRC_ASG_SPAN_DT_STAGE') }} SPAN
 WHERE  SPAN.EFFECTIVE_END_DATE >= SPAN.EFFECTIVE_START_DATE
