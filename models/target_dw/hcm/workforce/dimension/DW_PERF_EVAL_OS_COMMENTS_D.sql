 SELECT  CMNTS.EVALRATINGPEOEVALUATIONID AS EVALUATION_ID           , 
  CMNTS.EVALRATINGPEOREFERENCEID AS EVAL_SECTION_ID         , 
  CMNTS.EVALRATINGPEOBUSINESSGROUPID AS BUSINESS_GROUP_ID       , 
  TO_CHAR(CMNTS.EVALRATINGPEOEVALUATIONID) ||'~'|| TO_CHAR(CMNTS.EVALRATINGPEOREFERENCEID) ||'~'|| TO_CHAR(CMNTS.EVALRATINGPEOBUSINESSGROUPID) AS SOURCE_RECORD_ID        , 
  COALESCE(MIN(CASE WHEN CMNTS.EVALRATINGPEOROLETYPECODE  = 'MANAGER' THEN CMNTS.EVALRATINGPEOEVALPARTICIPANTID END),-99999) AS MANAGER_PARTICIPANT_ID  , 
  COALESCE(MIN(CASE WHEN CMNTS.EVALRATINGPEOROLETYPECODE  = 'WORKER' THEN CMNTS.EVALRATINGPEOEVALPARTICIPANTID END),-99999) AS WORKER_PARTICIPANT_ID   , 
  COALESCE(MIN(CASE WHEN CMNTS.EVALRATINGPEOROLETYPECODE  = 'MANAGER' THEN CMNTS.EVALRATINGPEOCOMMENTS END),'~NOVALUE~') AS MANAGER_OVERALL_COMMENTS, 
  COALESCE(MIN(CASE WHEN CMNTS.EVALRATINGPEOROLETYPECODE  = 'WORKER' THEN CMNTS.EVALRATINGPEOCOMMENTS END),'~NOVALUE~') AS WORKER_OVERALL_COMMENTS 
 FROM  {{ ref('stg_h_hcmperformancedocsam_performancesectionratingpvo.cmnts') }} CMNTS INNER JOIN {{ ref('DW_PERF_EVAL_SECTION_D') }} EVS  ON ( CMNTS.EVALRATINGPEOREFERENCEID =EVS.EVAL_SECTION_ID AND CMNTS.EVALRATINGPEOBUSINESSGROUPID=EVS.BUSINESS_GROUP_ID )
 WHERE  CMNTS.EVALRATINGPEOREFERENCETYPE = 'SECTION' AND EVS.SECTION_TYPE_CODE = 'OS' AND CMNTS.EVALRATINGPEOROLETYPECODE IN ('MANAGER','WORKER') GROUP BY  CMNTS.EVALRATINGPEOEVALUATIONID, CMNTS.EVALRATINGPEOREFERENCEID, CMNTS.EVALRATINGPEOBUSINESSGROUPID, TO_CHAR(CMNTS.EVALRATINGPEOEVALUATIONID) ||'~'|| TO_CHAR(CMNTS.EVALRATINGPEOREFERENCEID) ||'~'|| TO_CHAR(CMNTS.EVALRATINGPEOBUSINESSGROUPID)
