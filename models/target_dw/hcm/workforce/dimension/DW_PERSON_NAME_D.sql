 SELECT  	PERSONNAME.PERSONNAMEID AS PERSON_NAME_ID	 , 
 	PERSONNAME.EFFECTIVESTARTDATE AS EFFECTIVE_START_DATE	, 
 	PERSONNAME.EFFECTIVEENDDATE AS EFFECTIVE_END_DATE	, 
  	CAST(PERSONNAME.PERSONNAMEID AS STRING)||'~'||FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', PERSONNAME.EFFECTIVESTARTDATE))||'~'||FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', PERSONNAME.EFFECTIVEENDDATE)) AS SOURCE_RECORD_ID	 , 
 	PERSONNAME.PERSONNAMEPEOPERSONID AS PERSON_ID	, 
 		PERSONNAME.PERSONNAMEPEOLEGISLATIONCODE AS LEGISLATION_CODE	, 
 		PERSONNAME.PERSONNAMEPEONAMETYPE AS NAME_TYPE	, 
 		PERSONNAME.PERSONNAMEPEODISPLAYNAME AS DISPLAY_NAME	, 
 		PERSONNAME.PERSONNAMEPEOFIRSTNAME AS FIRST_NAME	, 
 		PERSONNAME.PERSONNAMEPEOLASTNAME AS LAST_NAME	, 
 		PERSONNAME.PERSONNAMEPEOMIDDLENAMES AS MIDDLE_NAMES	, 
 		PERSONNAME.PERSONNAMEPEOTITLE AS TITLE	, 
 		PERSONNAME.PERSONNAMEPEOPRENAMEADJUNCT AS PRE_NAME_ADJUNCT	, 
 		PERSONNAME.PERSONNAMEPEOSUFFIX AS SUFFIX	, 
 		PERSONNAME.PERSONNAMEPEOKNOWNAS AS KNOWN_AS	, 
 		PERSONNAME.PERSONNAMEPEOPREVIOUSLASTNAME AS PREVIOUS_LAST_NAME	, 
 	PERSONNAME.PERSONNAMEPEOFULLNAME AS FULL_NAME	, 
 	PERSONNAME.PERSONNAMEPEOLISTNAME AS LIST_NAME	, 
 	PERSONNAME.PERSONNAMEPEOORDERNAME AS ORDER_NAME	, 
 CASE WHEN PARSE_DATE('%Y-%m-%d', '{{ var("VAR_PARAM_GLOBAL_INITIAL_EXTRACT_DATE") }}') > PARSE_DATE('%Y-%m-%d', PERSONNAME.EFFECTIVESTARTDATE ) THEN PARSE_DATE('%Y-%m-%d', '{{ var("VAR_PARAM_GLOBAL_INITIAL_EXTRACT_DATE") }}') ELSE PARSE_DATE('%Y-%m-%d', PERSONNAME.EFFECTIVESTARTDATE) END AS DW_DATE_FROM, 
 PERSONNAME.EFFECTIVEENDDATE AS DW_DATE_TO, 
  CASE WHEN PARSE_DATE('%Y-%m-%d', '{{ var("VAR_PARAM_GLOBAL_INITIAL_EXTRACT_DATE") }}') > PARSE_DATE('%Y-%m-%d', PERSONNAME.EFFECTIVESTARTDATE)  THEN 1 ELSE 0 END AS DW_INITIAL_RECORD_IND
 FROM {{ ref('stg_h_personam_personnamepvoviewall') }} PERSONNAME

