 SELECT  FACT.ASSIGNMENT_ID AS ASSIGNMENT_ID , 
  FACT.CALENDAR_DATE AS CALENDAR_DATE , 
  FACT.SOURCE_RECORD_ID AS SOURCE_RECORD_ID , 
  PRD.FISCAL_PERIOD_SET_NAME AS FISCAL_PERIOD_SET_NAME , 
  PRD.FISCAL_PERIOD_NAME AS FISCAL_PERIOD_NAME , 
  PRD.FISCAL_PERIOD_SORT_KEY AS FISCAL_PERIOD_SORT_KEY , 
  PRD.FISCAL_PERIOD_TYPE AS FISCAL_PERIOD_TYPE , 
  PRD.FISCAL_DAY_DATE AS FISCAL_DAY_DATE, 
  PRD.FISCAL_QUARTER_CODE AS FISCAL_QUARTER_CODE , 
  PRD.FISCAL_YEAR_NUMBER AS FISCAL_YEAR_NUMBER , 
  CASE WHEN  PRD.LAST_DAY_FISCAL_QUARTER_FLAG = 'Y' OR PRD.CURRENT_FISCAL_DAY_CODE = 'Current' THEN 'Y' ELSE 'N' END AS LAST_PERIOD_IN_FISCAL_QUARTER_FLAG , 
  CASE WHEN PRD.LAST_DAY_FISCAL_YEAR_FLAG = 'Y' OR PRD.CURRENT_FISCAL_DAY_CODE = 'Current' THEN 'Y' ELSE 'N' END AS LAST_PERIOD_IN_FISCAL_YEAR_FLAG , 
  CASE WHEN PRD.CURRENT_FISCAL_DAY_CODE = 'Current' THEN 'Y' ELSE 'N' END AS CURRENT_FLAG, 
  FACT.DEPARTMENT_ID AS DEPARTMENT_ID , 
  FACT.REPORTING_ESTABLISHMENT_ID AS REPORTING_ESTABLISHMENT_ID, 
  FACT.JOB_ID AS JOB_ID , 
  FACT.JOB_FAMILY_ID AS JOB_FAMILY_ID , 
  FACT.LOCATION_ID AS LOCATION_ID , 
  FACT.POSITION_ID AS POSITION_ID , 
  FACT.GRADE_ID AS GRADE_ID , 
  FACT.RATE_VALUE_ID AS RATE_VALUE_ID , 
  FACT.RATE_ID AS RATE_ID , 
  FACT.SALARY_BASIS_ID AS SALARY_BASIS_ID , 
  FACT.LEGAL_EMPLOYER_ID AS LEGAL_EMPLOYER_ID , 
  FACT.BUSINESS_UNIT_ID AS BUSINESS_UNIT_ID , 
  FACT.PERIOD_OF_SERVICE_ID AS PERIOD_OF_SERVICE_ID , 
  FACT.PERSON_ID AS PERSON_ID , 
  FACT.PERSON_TYPE_ID AS PERSON_TYPE_ID , 
  FACT.ASSIGNMENT_STATUS_TYPE_ID AS ASSIGNMENT_STATUS_TYPE_ID , 
  FACT.MANAGER_ASSIGNMENT_ID AS MANAGER_ASSIGNMENT_ID , 
  FACT.MANAGER_ID AS MANAGER_ID , 
  FACT.PERFORMANCE_RATING_LEVEL_ID AS PERFORMANCE_RATING_LEVEL_ID, 
  FACT.POTENTIAL_RATING_LEVEL_ID AS POTENTIAL_RATING_LEVEL_ID, 
  FACT.WORKER_TYPE AS WORKER_TYPE , 
  FACT.WORKER_CATEGORY AS WORKER_CATEGORY , 
  FACT.ASSIGNMENT_CATEGORY AS ASSIGNMENT_CATEGORY , 
  FACT.LEGISLATION_CODE AS LEGISLATION_CODE , 
  FACT.COUNTRY AS COUNTRY , 
  FACT.SEX AS SEX , 
  FACT.MARITAL_STATUS AS MARITAL_STATUS , 
  FACT.HIGHEST_EDUCATION_LEVEL AS HIGHEST_EDUCATION_LEVEL , 
  FACT.ETHNICITY AS ETHNICITY , 
  FACT.RELIGION AS RELIGION , 
  --FACT.DISABILITY_FLAG AS DISABILITY_FLAG , 
  FACT.PRIMARY_FLAG AS PRIMARY_FLAG , 
  FACT.PRIMARY_ASSIGNMENT_FLAG AS PRIMARY_ASSIGNMENT_FLAG , 
  FACT.ASSIGNMENT_NUMBER AS ASSIGNMENT_NUMBER, 
  FACT.ASSIGNMENT_NAME AS ASSIGNMENT_NAME, 
  FACT.SYSTEM_PERSON_TYPE AS SYSTEM_PERSON_TYPE , 
  FACT.PAY_SYSTEM_STATUS AS PAY_SYSTEM_STATUS , 
  FACT.PER_SYSTEM_STATUS AS PER_SYSTEM_STATUS , 
  FACT.DATE_OF_BIRTH AS DATE_OF_BIRTH , 
  FACT.DATE_START AS DATE_START , 
  FACT.ACTUAL_TERMINATION_DATE AS ACTUAL_TERMINATION_DATE , 
  --FACT.MANAGER_IND AS MANAGER_IND , 
  FACT.AGE_IN_YEARS AS AGE_IN_YEARS , 
  FACT.AGE_IN_MONTHS AS AGE_IN_MONTHS , 
  FACT.TENURE_IN_YEARS AS TENURE_IN_YEARS , 
  FACT.TENURE_IN_MONTHS AS TENURE_IN_MONTHS , 
  FACT.DAYS_SINCE_LATEST_PROMOTION AS DAYS_SINCE_LATEST_PROMOTION , 
  FACT.COMPUTED_COMPA_RATIO AS COMPUTED_COMPA_RATIO , 
  FACT.ANNUALIZED_SALARY AS ANNUALIZED_SALARY , 
  FACT.COMPUTED_ANNUALIZED_SALARY AS COMPUTED_ANNUALIZED_SALARY, 
  FACT.CURRENCY_CODE AS CURRENCY_CODE , 
  FACT.FTE AS FTE , 
  FACT.HEADCOUNT AS HEADCOUNT 
 FROM  {{ ref('DW_CONTENT_PARAM_CONFIG') }} CFG 
 INNER JOIN {{ ref('DW_FISCAL_DAY_D') }} PRD  ON CFG.PARAMETER_VALUE = PRD.FISCAL_PERIOD_SET_NAME 
 INNER JOIN  {{ ref('DW_WRKFRC_ASG_SNAPSHOT_F') }} FACT  ON (CASE WHEN PRD.LAST_DAY_FISCAL_PERIOD_FLAG = 'Y' THEN DATE(PRD.FISCAL_PERIOD_END_DATE) ELSE DATE(PRD.FISCAL_DAY_DATE) END) = FACT.CALENDAR_DATE
 WHERE CFG.PARAMETER_CODE = 'PARAM_ERP_FINANCIALS_CALENDAR_ID' AND (PRD.LAST_DAY_FISCAL_PERIOD_FLAG = 'Y' OR PRD.CURRENT_FISCAL_DAY_CODE = 'Current') AND PRD.ADJUSTMENT_PERIOD_FLAG <> 'Y'
