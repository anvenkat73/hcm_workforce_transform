SELECT  GLFISCALPERIODPVO.FISCALPERIODSETNAME AS FISCAL_PERIOD_SET_NAME , 
  GLFISCALPERIODPVO.FISCALPERIODNAME AS FISCAL_PERIOD_NAME , 
  GLFISCALPERIODPVO.FISCALPERIODSETNAME||'~'||GLFISCALPERIODPVO.FISCALPERIODNAME AS SOURCE_RECORD_ID , 
  GLFISCALPERIODPVO.FISCALPERIODSETNAME||'~'||GLFISCALPERIODPVO.FISCALPERIODTYPE||'~'|| (GLFISCALPERIODPVO.FISCALPERIODFISCALYEARNUMBER*100+GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODNUMBER) AS FISCAL_PERIOD_SORT_KEY , 
  GLFISCALPERIODPVO.FISCALPERIODTYPE AS FISCAL_PERIOD_TYPE , 
  GLFISCALPERIODPVO.FISCALPERIODADJUSTMENTPERIODFLAG AS ADJUSTMENT_PERIOD_FLAG , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODNUMBER AS FISCAL_PERIOD_NUMBER , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE AS FISCAL_PERIOD_START_DATE , 
   CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE)) as INT64)  AS FISCAL_PERIOD_START_DATE_ID , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE AS FISCAL_PERIOD_END_DATE , 
   CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)) as INT64)  AS FISCAL_PERIOD_END_DATE_ID , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALYEARNUMBER AS FISCAL_YEAR_NUMBER , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERNUMBER AS FISCAL_QUARTER_NUMBER , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALYEARNUMBER||'Q'||GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERNUMBER AS FISCAL_QUARTER_CODE , 
  CASE WHEN GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERNUMBER < 3 THEN 1 ELSE 2 END AS FISCAL_HALF_NUMBER , 
  CEIL(((  CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)) as INT64) - CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE)) as INT64)  )+1)/7) AS FISCAL_PERIOD_TOTAL_WEEKS , 
  ROUND((CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)) as INT64)  -
        CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE)) as INT64))+1) AS FISCAL_PERIOD_TOTAL_DAYS , 
  CEIL((( CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)) as INT64) - CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALYEARSTARTDATE)) as INT64)  )+1)/7) AS FISCAL_YEAR_TOTAL_WEEKS , 
  ROUND(( CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALYEARENDDATE)) as INT64) - 
           CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALYEARSTARTDATE)) as INT64))
           +1) AS FISCAL_YEAR_TOTAL_DAYS , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERSTARTDATE AS FISCAL_QUARTER_START_DATE , 
  CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERSTARTDATE)) as INT64)  AS FISCAL_QUARTER_START_DATE_ID , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERENDDATE AS FISCAL_QUARTER_END_DATE , 
   CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERENDDATE)) as INT64)   AS FISCAL_QUARTER_END_DATE_ID , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALYEARSTARTDATE AS FISCAL_YEAR_START_DATE , 
    CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALYEARSTARTDATE)) as INT64)  AS FISCAL_YEAR_START_DATE_ID , 
  GLFISCALPERIODPVO.FISCALPERIODFISCALYEARENDDATE AS FISCAL_YEAR_END_DATE , 
  CAST( FORMAT_DATE('%Y%m%d', PARSE_DATE('%Y-%m-%d', GLFISCALPERIODPVO.FISCALPERIODFISCALYEARENDDATE)) as INT64)  AS FISCAL_YEAR_END_DATE_ID , 
  CASE WHEN GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE = GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERSTARTDATE THEN 'Y' ELSE 'N' END AS FIRST_PERIOD_FISCAL_QTR_FLAG , 
  CASE WHEN GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE = GLFISCALPERIODPVO.FISCALPERIODFISCALQUARTERENDDATE THEN 'Y' ELSE 'N' END AS LAST_PERIOD_FISCAL_QTR_FLAG , 
  CASE WHEN GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE = GLFISCALPERIODPVO.FISCALPERIODFISCALYEARSTARTDATE THEN 'Y' ELSE 'N' END AS FIRST_PERIOD_FISCAL_YEAR_FLAG , 
  CASE WHEN GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE = GLFISCALPERIODPVO.FISCALPERIODFISCALYEARENDDATE THEN 'Y' ELSE 'N' END AS LAST_PERIOD_FISCAL_YEAR_FLAG , 
 GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE AS PERIOD_END_OR_PRV_CRNT_DATE,
CASE WHEN CURRENT_DATE() between  PARSE_DATE('%Y-%m-%d',GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE) and   PARSE_DATE('%Y-%m-%d',GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)  THEN 'Current' ELSE null END as  CURRENT_FISCAL_WEEK_CODE,
 CASE WHEN CURRENT_DATE() between  PARSE_DATE('%Y-%m-%d',GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE) and   PARSE_DATE('%Y-%m-%d',GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)  THEN 'Current' ELSE null END as  CURRENT_FISCAL_QUARTER_CODE,
CASE WHEN CURRENT_DATE() between  PARSE_DATE('%Y-%m-%d',GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODSTARTDATE) and   PARSE_DATE('%Y-%m-%d',GLFISCALPERIODPVO.FISCALPERIODFISCALPERIODENDDATE)  THEN 'Current' ELSE null END as  CURRENT_FISCAL_YEAR_CODE

 FROM {{ ref('stg_f_finglcalaccam_glfiscalperiodpvo') }} GLFiscalPeriodPVO

